<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Clippy &mdash; Settings</title>
  <link rel="stylesheet" href="settings.css">
</head>
<body>

  <form id="settings-form">

    <!-- ============ Connection ============ -->
    <fieldset class="section">
      <legend>Connection</legend>

      <div class="field">
        <label for="api-endpoint">API Base URL</label>
        <input type="text" id="api-endpoint" name="api-endpoint"
               placeholder="https://api.groq.com/openai/v1">
        <p class="hint">
          Ollama: <code>http://localhost:11434/v1</code>
          &mdash;
          Groq: <code>https://api.groq.com/openai/v1</code>
        </p>
      </div>

      <div class="field">
        <label for="api-key">API Key</label>
        <input type="password" id="api-key" name="api-key">
      </div>

      <div class="field">
        <label for="model">Model</label>
        <input type="text" id="model" name="model">
        <p class="hint">
          Ollama: <code>qwen3</code>, <code>glm-4.7-flash</code>
          &mdash;
          Groq: <code>compound</code>, <code>meta-llama/llama-4-scout-17b-16e-instruct</code>
        </p>
      </div>
    </fieldset>

    <!-- ============ Behavior ============ -->
    <fieldset class="section">
      <legend>Behavior</legend>

      <!-- ============ Disable Characters ============ 
      <div class="field">
        <label for="character">Character</label>
        <select id="character" name="character">
          <option value="Bonzi">Bonzi</option>
          <option value="Clippy">Clippy</option>
          <option value="F1">F1</option>
          <option value="Genie">Genie</option>
          <option value="Genius">Genius</option>
          <option value="Links">Links</option>
          <option value="Merlin">Merlin</option>
          <option value="Peedy">Peedy</option>
          <option value="Rocky">Rocky</option>
          <option value="Rover">Rover</option>
        </select>
      </div> -->

      <label class="check">
        <input type="checkbox" id="eliza-mode" name="eliza-mode">
        <span class="check-label">Eliza Mode</span>
        <span class="check-desc">Show Eliza's response as a suggestion to the LLM</span>
      </label>

      <label class="check">
        <input type="checkbox" id="enable-animations" name="enable-animations">
        <span class="check-label">Enable Animations</span>
        <span class="check-desc">Suggests animations to the LLM</span>
      </label>
    </fieldset>

    <!-- ============ Intelligent Memory ============ -->
    <fieldset class="section">
      <legend>Intelligent Memory</legend>

      <label class="check">
        <input type="checkbox" id="intelligent-memory" name="intelligent-memory">
        <span class="check-label">Enable Intelligent Memory</span>
        <span class="check-desc">Long-term memory: Clippy remembers conversations and learns over time</span>
      </label>

      <div id="memory-options" class="sub-options">
        <div class="field">
          <label for="embedding-provider">Embedding Provider</label>
          <select id="embedding-provider" name="embedding-provider">
            <option value="local">Local Model</option>
            <option value="openai">OpenAI API</option>
          </select>
        </div>

        <div id="openai-embedding-options">
          <div class="field">
            <label for="openai-embedding-api-key">OpenAI API Key</label>
            <input type="password" id="openai-embedding-api-key"
                   name="openai-embedding-api-key" placeholder="sk-...">
          </div>
          <div class="field">
            <label for="openai-embedding-base-url">OpenAI Base URL</label>
            <input type="text" id="openai-embedding-base-url"
                   name="openai-embedding-base-url"
                   placeholder="https://api.openai.com/v1">
          </div>
          <div class="field">
            <label for="openai-embedding-model">Embedding Model</label>
            <input type="text" id="openai-embedding-model"
                   name="openai-embedding-model"
                   placeholder="text-embedding-ada-002">
            <p class="hint">e.g. <code>text-embedding-ada-002</code>, <code>text-embedding-3-small</code>, <code>text-embedding-3-large</code></p>
          </div>
        </div>

        <label class="check">
          <input type="checkbox" id="memory-read-news" name="memory-read-news">
          <span class="check-label">Read News</span>
          <span class="check-desc">Allow memory to read news for background learning</span>
        </label>

        <label class="check">
          <input type="checkbox" id="irobot-mode" name="irobot-mode">
          <span class="check-label">i, Robot Mode</span>
          <span class="check-desc">Autonomous continuous agent with memory and reasoning</span>
        </label>

        <label class="check">
          <input type="checkbox" id="web-search-enabled" name="web-search-enabled">
          <span class="check-label">Web Search</span>
          <span class="check-desc">Allow the agent to search the web for current information (built-in, no MCP needed). Requires Anthropic API.</span>
        </label>

        <div class="field-row">
          <button type="button" id="clear-memory" class="btn">Clear Memory</button>
          <span class="status-inline">Status: <span id="memory-status">idle</span></span>
          <span class="check-desc">This will reset it to a new baby</span>
        </div>
      </div>
    </fieldset>

    <!-- ============ Symbolic Reasoning ============ -->
    <fieldset class="section">
      <legend>Symbolic Reasoning</legend>

      <label class="check">
        <input type="checkbox" id="symbolic-enabled" name="symbolic-enabled">
        <span class="check-label">Enable Symbolic Reasoning</span>
        <span class="check-desc">Formal reasoning engines for i, Robot mode (requires OpenAI-compatible API)</span>
      </label>

      <div id="symbolic-options" class="sub-options">
        <p class="hint">Uses the API connection configured above.</p>

        <fieldset class="inner-fieldset">
          <legend>Reasoning Engines</legend>
          <label class="check">
            <input type="checkbox" id="symbolic-algebrite" name="symbolic-algebrite">
            <span class="check-label">Algebrite</span>
            <span class="check-desc">Computer algebra: simplify, solve, calculus</span>
          </label>
          <label class="check">
            <input type="checkbox" id="symbolic-z3" name="symbolic-z3">
            <span class="check-label">z3-solver</span>
            <span class="check-desc">SMT solving: logic, constraints, verification</span>
          </label>
          <label class="check">
            <input type="checkbox" id="symbolic-swipl" name="symbolic-swipl">
            <span class="check-label">swipl-wasm</span>
            <span class="check-desc">Prolog: rules, knowledge bases, unification</span>
          </label>
        </fieldset>

        <fieldset class="inner-fieldset" id="mcp-reasoning-fieldset">
          <legend>MCP Servers - Reasoning</legend>
          <div id="mcp-irobot-warning" class="mcp-disabled-warning" style="display: none;">
            MCP servers are disabled while i, Robot mode is active.
          </div>
          <p class="hint">External reasoning services via Model Context Protocol.</p>
          <div id="mcp-server-list"></div>
          <div class="mcp-add-row" id="mcp-reasoning-add-row">
            <input type="text" id="mcp-new-name" placeholder="Name">
            <input type="text" id="mcp-new-url" placeholder="http://localhost:3000">
            <input type="text" id="mcp-new-desc" placeholder="Description">
            <button type="button" id="mcp-add-btn" class="btn btn-small">Add</button>
          </div>
        </fieldset>
      </div>
    </fieldset>

    <!-- ============ Extensions ============ -->
    <fieldset class="section" id="extensions-section" style="display: none;">
      <legend>Extensions</legend>

      <fieldset class="inner-fieldset" id="mcp-general-fieldset">
        <legend>MCP Servers - General</legend>
        <div id="general-mcp-irobot-warning" class="mcp-disabled-warning" style="display: none;">
          MCP servers are disabled while i, Robot mode is active.
        </div>
        <p class="hint">Add external services via Model Context Protocol for web search, code execution, and more.</p>
        <div id="general-mcp-server-list"></div>
        <div class="mcp-add-row" id="mcp-general-add-row">
          <input type="text" id="general-mcp-new-name" placeholder="Name">
          <input type="text" id="general-mcp-new-url" placeholder="http://localhost:3000">
          <input type="text" id="general-mcp-new-desc" placeholder="Description">
          <button type="button" id="general-mcp-add-btn" class="btn btn-small">Add</button>
        </div>
      </fieldset>
    </fieldset>

    <!-- ============ Model Benchmark ============ -->
    <fieldset class="section" id="benchmark-section" style="display: none;">
      <legend>Model Benchmark</legend>
      <p class="hint">
        Test model capability for i, Robot mode. Results upload to the
        <a href="https://huggingface.co/spaces/npc0/clippy-irobot-bench"
           target="_blank">community leaderboard</a>.
      </p>

      <div class="benchmark-cost-warning">
        <strong>Token usage warning:</strong> The benchmark sends many prompts
        to your API (8 internal categories + 4 external benchmarks). For powerful
        models this can cost <strong>$5&ndash;$30+</strong> depending on the
        provider and model. Your results will become an invaluable reference
        for the whole community &mdash; but only run this if you are willing to
        pay the bill.
        <br><br>
        <strong>Tip:</strong> Set a budget/spending limit on your API provider
        <em>before</em> running the benchmark to protect yourself from
        unexpected charges.
      </div>

      <div id="benchmark-model-status" class="benchmark-status"></div>

      <div class="field-row">
        <button type="button" id="check-leaderboard-btn" class="btn btn-small">Check Leaderboard</button>
        <button type="button" id="run-benchmark-btn" class="btn btn-small">Run Benchmark</button>
      </div>

      <div id="benchmark-progress" style="display: none;">
        <p id="benchmark-phase-label" class="benchmark-phase-label"></p>
        <div class="benchmark-progress-bar">
          <div class="benchmark-progress-fill" id="benchmark-fill"></div>
        </div>
        <p id="benchmark-progress-text" class="hint"></p>
      </div>

      <div id="benchmark-results" style="display: none;">
        <h3>Results</h3>
        <div id="benchmark-results-table"></div>
        <div id="benchmark-overall"></div>
      </div>
    </fieldset>

    <!-- Benchmark Cost Confirmation Modal -->
    <div id="benchmark-confirm" class="modal">
      <div class="modal-content">
        <span class="close-button" id="benchmark-confirm-close">&times;</span>
        <h2>Run Benchmark?</h2>
        <p>
          The benchmark will send a large number of prompts to your API
          endpoint. Depending on the model and provider this can consume
          a significant amount of tokens and may incur costs of
          <strong>$5&ndash;$30+</strong>.
        </p>
        <p>
          Please make sure you have set a <strong>budget limit</strong> on
          your API provider before continuing.
        </p>
        <p>
          Your results will be shared on the community leaderboard and help
          everyone choose the right model for i, Robot mode.
        </p>
        <div class="modal-actions">
          <button type="button" id="confirm-benchmark-run" class="btn btn-primary">Run Benchmark</button>
          <button type="button" id="cancel-benchmark-run" class="btn">Cancel</button>
        </div>
      </div>
    </div>
    
    <!-- ============ Actions ============ -->
    <div class="actions">
      <button type="submit" class="btn btn-primary">Save</button>
    </div>
  </form>

  <!-- i, Robot Warning Modal -->
  <div id="irobot-warning" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2>Warning: i, Robot Mode</h2>
      <p>
        This mode gives Clippy autonomous agency. The assistant will
        continuously think, act, and learn on its own. Make sure you
        have configured your API endpoint and memory settings.
      </p>
      <div class="modal-actions">
        <button type="button" id="confirm-irobot-mode" class="btn btn-primary">Enable</button>
        <button type="button" id="cancel-irobot-mode" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Updates -->
  <div class="footer">
    <button type="button" id="check-for-updates" class="btn">Check for Updates</button>
  </div>

  <script src="settings.js"></script>
</body>
</html>
